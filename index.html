<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ENCRYPTED NUDES</title>
  <link rel="icon" type="image/png" href="/favicon.png" />
  <style>
    /* â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #C0C0C0;
      --surface:   #c7c7c7;
      --border:    #2a2a2a;
      --accent:    #fffbf2;
      --accent2:   #e9f3fa;
      --text:      #fffdfd;
      --muted:     #666;
      --success:   #4caf78;
      --error:     #e05c5c;
      --radius:    12px;
    }

    ::selection {
        background-color: blue;
    }

    body {
      background: radial-gradient(ellipse at 58% 28%,
        #fafafa 0%,
        #ececec 40%,
        #d4d4d4 75%,
        #c8c8c8 100%
      );
      color: var(--text);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 0 24px 24px;
      position: relative;
      z-index: 1;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      padding: 20px 0;
      margin-bottom: 40px;
    }

    header .lock-icon {
      font-size: 40px;
      margin-bottom: 12px;
      display: block;
    
    }

    header h1 {
      font-size: 1.6rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--accent);
    }

    header p {
      margin-top: 8px;
      font-size: 0.85rem;
      color: var(--muted);
      letter-spacing: 0.04em;
    }

    /* â”€â”€ Card â€” Win95 bevel + silver radial gradient + blur â”€â”€â”€â”€â”€ */
    .card {
      background: radial-gradient(ellipse at 58% 28%,
        rgba(250,250,250,0.72) 0%,
        rgba(236,236,236,0.65) 40%,
        rgba(212,212,212,0.60) 75%,
        rgba(200,200,200,0.58) 100%
      );
      backdrop-filter: blur(18px) saturate(1.4);
      -webkit-backdrop-filter: blur(18px) saturate(1.4);
      border-radius: 0;
      padding: 36px;
      width: 100%;
      max-width: 480px;
      border-top:    2px solid rgba(255,255,255,0.9);
      border-left:   2px solid rgba(255,255,255,0.9);
      border-right:  2px solid rgba(0,0,0,0.6);
      border-bottom: 2px solid rgba(0,0,0,0.6);
      box-shadow:
        inset 1px 1px 0 rgba(255,255,255,0.8),
        inset -1px -1px 0 rgba(128,128,128,0.6);
    }

    /* â”€â”€ Card Description â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card-desc {
      margin-bottom: 24px;
      font-size: 0.85rem;
      color: #111;
      line-height: 1.7;
    }

    .card-desc p { margin-bottom: 4px; }

    .card-desc em {
      font-style: normal;
      font-weight: 700;
    }

    .card-link {
      color: #000080;
      text-decoration: underline;
    }

    .card-link:hover { color: #0000ff; }

    /* â”€â”€ Drop Zone â€” Win95 sunken/inset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #drop-zone {
      /* Inset bevel: dark top-left, light bottom-right */
      border-top:    2px solid #808080;
      border-left:   2px solid #808080;
      border-right:  2px solid #ffffff;
      border-bottom: 2px solid #ffffff;
      box-shadow: inset 1px 1px 0 #000000, inset -1px -1px 0 #dfdfdf;
      border-radius: 0;
      padding: 48px 24px;
      text-align: center;
      cursor: pointer;
      background: #c0c0c0;
      position: relative;
    }

    /* Hidden real input â€” label triggers it */
    #file-input {
      display: none;
    }

    #drop-zone.dragover {
      background: #b0b0b0;
    }

    #drop-zone .drop-icon {
      font-size: 36px;
      margin-bottom: 14px;
      display: block;
      opacity: 0.6;
    }

    #drop-zone .drop-title {
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 6px;
    }

    #drop-zone .drop-sub {
      font-size: 0.78rem;
      color: var(--muted);
    }

    /* "Browse file" â€” Aqua gel button */
    #drop-zone label {
      display: inline-block;
      margin-top: 16px;
      padding: 4px 18px;
      font-size: 0.8rem;
      font-weight: 500;
      color: #1a1a1a;
      cursor: pointer;
      border-radius: 12px;
      border: 1px solid #8a8a8a;
      background: linear-gradient(to bottom,
        #ffffff 0%,
        #e2e2e2 48%,
        #c8c8c8 52%,
        #dedede 100%
      );
      box-shadow:
        0 1px 3px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.85);
      text-shadow: 0 1px 0 rgba(255,255,255,0.6);
    }

    #drop-zone label:active {
      background: linear-gradient(to bottom,
        #c0c0c0 0%,
        #d8d8d8 48%,
        #e8e8e8 52%,
        #d0d0d0 100%
      );
      box-shadow: 0 0 2px rgba(0,0,0,0.2), inset 0 1px 2px rgba(0,0,0,0.15);
    }

    /* â”€â”€ Preview â€” Win95 sunken â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #preview-area {
      display: none;
      margin-top: 20px;
      border-top:    2px solid #808080;
      border-left:   2px solid #808080;
      border-right:  2px solid #ffffff;
      border-bottom: 2px solid #ffffff;
      box-shadow: inset 1px 1px 0 #000000, inset -1px -1px 0 #dfdfdf;
      border-radius: 0;
      overflow: hidden;
      position: relative;
    }

    #preview-area img {
      width: 100%;
      max-height: 240px;
      object-fit: cover;
      display: block;
    }

    #preview-area .preview-meta {
      padding: 10px 14px;
      font-size: 0.78rem;
      color: var(--muted);
      background: #c0c0c0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #preview-area .preview-meta span {
      color: #000000;
      font-weight: 500;
    }

    /* Clear button â€” Aqua gel (small) */
    #clear-btn {
      cursor: pointer;
      font-size: 0.7rem;
      line-height: 1;
      padding: 2px 9px;
      color: #1a1a1a;
      border-radius: 10px;
      border: 1px solid #8a8a8a;
      background: linear-gradient(to bottom,
        #ffffff 0%,
        #e2e2e2 48%,
        #c8c8c8 52%,
        #dedede 100%
      );
      box-shadow:
        0 1px 3px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.85);
      text-shadow: 0 1px 0 rgba(255,255,255,0.6);
    }

    #clear-btn:active {
      background: linear-gradient(to bottom,
        #c0c0c0 0%,
        #d8d8d8 48%,
        #e8e8e8 52%,
        #d0d0d0 100%
      );
      box-shadow: 0 0 2px rgba(0,0,0,0.2), inset 0 1px 2px rgba(0,0,0,0.15);
    }

    /* â”€â”€ Progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #progress-wrap {
      display: none;
      margin-top: 20px;
    }

    #progress-label {
      font-size: 0.75rem;
      color: var(--muted);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
    }

    #progress-bar-track {
      height: 4px;
      background: var(--border);
      border-radius: 99px;
      overflow: hidden;
    }

    #progress-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent2), var(--accent));
      border-radius: 99px;
      transition: width 0.3s ease;
    }

    /* â”€â”€ Upload Button â€” Aqua gel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #upload-btn {
      display: block;
      width: 100%;
      margin-top: 20px;
      padding: 7px 14px;
      font-size: 0.85rem;
      font-weight: 500;
      color: #1a1a1a;
      cursor: pointer;
      border-radius: 14px;
      border: 1px solid #7a7a7a;
      background: linear-gradient(to bottom,
        #ffffff 0%,
        #e2e2e2 48%,
        #c8c8c8 52%,
        #dedede 100%
      );
      box-shadow:
        0 1px 4px rgba(0,0,0,0.35),
        inset 0 1px 0 rgba(255,255,255,0.9);
      text-shadow: 0 1px 0 rgba(255,255,255,0.6);
    }

    #upload-btn:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    #upload-btn:not(:disabled):active {
      background: linear-gradient(to bottom,
        #c0c0c0 0%,
        #d8d8d8 48%,
        #e8e8e8 52%,
        #d0d0d0 100%
      );
      box-shadow: 0 0 2px rgba(0,0,0,0.2), inset 0 1px 2px rgba(0,0,0,0.15);
    }

    /* â”€â”€ Status â€” Win95 sunken box â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #status {
      display: none;
      margin-top: 16px;
      padding: 8px 12px;
      font-size: 0.82rem;
      font-weight: 400;
      background: #c0c0c0;
      color: #000000;
      border-top:    2px solid #808080;
      border-left:   2px solid #808080;
      border-right:  2px solid #ffffff;
      border-bottom: 2px solid #ffffff;
      box-shadow: inset 1px 1px 0 #000000, inset -1px -1px 0 #dfdfdf;
    }

    #status.success { color: #006400; }
    #status.error   { color: #8b0000; }

    /* â”€â”€ Background Gallery â€” floating jellyfish â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #gallery {
      position: fixed;
      inset: 0;
      z-index: 0;
      overflow: hidden;
      pointer-events: none;
    }

    #gallery .gallery-cell {
      position: absolute;
      top: 0;
      left: 0;
      width: 160px;
      will-change: transform;
    }

    #gallery .gallery-cell img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: contain;
    }

    /* â”€â”€ Security Badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .badge-row {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 28px;
    }

    .badge {
      font-size: 0.7rem;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 5px;
      letter-spacing: 0.04em;
    }

    .badge::before {
      content: 'âœ¦';
      color: var(--accent);
      font-size: 0.6rem;
    }
  </style>
</head>
<body>

  <!-- Background image gallery (z-index: 0, behind everything) -->
  <div id="gallery"></div>

  <header>
    <!-- <span class="lock-icon">ğŸ”’</span> -->
    <h1>Cr|_|d3  3n(rÂ¥|>+|on5</h1>
    <!-- <p>End-to-end encrypted Â· Images never leave your browser in plaintext</p> -->
  </header>

  <div class="card">

    <!-- Description -->
    <div class="card-desc">
      <p>Send ur nudes.</p>
      <p>This website is <em>SECURE</em></p>
      <p>You will remain anonymous.</p>
      <p><em>ARTIST</em> will hand-encrypt your image â€” <i>so tender, so caring, so artisanal.</i></p>
      <p>Each <i>encrypted</i> nude artwork will be exhibited on this website, and a select number will be printed and sold, as a limited edition postcard set, on Metalabel.</p>
      <p>You can support the project and this website through Metalabel <a href="#" class="card-link">here</a></p>
    </div>

    <!-- Drop Zone -->
    <div id="drop-zone">
      <!-- <span class="drop-icon">ğŸ–¼ï¸</span> -->
      <p class="drop-title">Drag &amp; drop an image here</p>
      <p class="drop-sub">JPEG, PNG, GIF, WEBP, AVIF Â· Max ~75 MB</p>
      <label for="file-input">Browse file</label>
      <input type="file" id="file-input" accept="image/*" />
    </div>

    <!-- Image Preview -->
    <div id="preview-area">
      <img id="preview-img" src="" alt="Preview" />
      <div class="preview-meta">
        <div><span id="preview-name"></span> &mdash; <span id="preview-size"></span></div>
        <button id="clear-btn" title="Remove">âœ•</button>
      </div>
    </div>

    <!-- Progress -->
    <div id="progress-wrap">
      <div id="progress-label">
        <span id="progress-step">Encryptingâ€¦</span>
        <span id="progress-pct">0%</span>
      </div>
      <div id="progress-bar-track">
        <div id="progress-bar-fill"></div>
      </div>
    </div>

    <!-- Upload Button -->
    <button id="upload-btn" disabled>Encrypt &amp; Send</button>

    <!-- Status -->
    <div id="status"></div>

  </div>

  <!-- Security badges -->
  <div class="badge-row">
    <span class="badge">RSA-2048</span>
    <span class="badge">AES-256-GCM</span>
    <span class="badge">Client-side only</span>
  </div>

  <script>
    // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let rsaPublicKey = null;
    let selectedFile = null;

    // â”€â”€ Elements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const dropZone    = document.getElementById('drop-zone');
    const fileInput   = document.getElementById('file-input');
    const previewArea = document.getElementById('preview-area');
    const previewImg  = document.getElementById('preview-img');
    const previewName = document.getElementById('preview-name');
    const previewSize = document.getElementById('preview-size');
    const clearBtn    = document.getElementById('clear-btn');
    const progressWrap = document.getElementById('progress-wrap');
    const progressStep = document.getElementById('progress-step');
    const progressPct  = document.getElementById('progress-pct');
    const progressFill = document.getElementById('progress-bar-fill');
    const uploadBtn   = document.getElementById('upload-btn');
    const statusEl    = document.getElementById('status');

    // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function formatBytes(n) {
      if (n < 1024)    return `${n} B`;
      if (n < 1048576) return `${(n / 1024).toFixed(1)} KB`;
      return `${(n / 1048576).toFixed(2)} MB`;
    }

    function setProgress(step, pct) {
      progressWrap.style.display = 'block';
      progressStep.textContent = step;
      progressPct.textContent  = `${pct}%`;
      progressFill.style.width = `${pct}%`;
    }

    function showStatus(msg, type) {
      statusEl.textContent = msg;
      statusEl.className   = type;
      statusEl.style.display = 'block';
    }

    function bufferToBase64(buffer) {
      const bytes = new Uint8Array(buffer);
      let binary = '';
      for (let i = 0; i < bytes.byteLength; i++) binary += String.fromCharCode(bytes[i]);
      return btoa(binary);
    }

    function pemToArrayBuffer(pem) {
      const b64 = pem
        .replace(/-----BEGIN PUBLIC KEY-----/, '')
        .replace(/-----END PUBLIC KEY-----/, '')
        .replace(/\s+/g, '');
      const binary = atob(b64);
      const bytes = new Uint8Array(binary.length);
      for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
      return bytes.buffer;
    }

    // â”€â”€ File Selection & Preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function handleFile(file) {
      if (!file || !file.type.startsWith('image/')) {
        showStatus('Please select an image file.', 'error');
        return;
      }
      selectedFile = file;
      statusEl.style.display = 'none';
      progressWrap.style.display = 'none';

      const reader = new FileReader();
      reader.onload = (e) => {
        previewImg.src = e.target.result;
        previewName.textContent = file.name;
        previewSize.textContent = formatBytes(file.size);
        previewArea.style.display = 'block';
      };
      reader.readAsDataURL(file);

      uploadBtn.disabled = !rsaPublicKey;
    }

    fileInput.addEventListener('change', () => {
      if (fileInput.files[0]) handleFile(fileInput.files[0]);
    });

    clearBtn.addEventListener('click', () => {
      selectedFile = null;
      fileInput.value = '';
      previewArea.style.display = 'none';
      progressWrap.style.display = 'none';
      statusEl.style.display = 'none';
      uploadBtn.disabled = true;
    });

    // â”€â”€ Drag & Drop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(ev => {
      dropZone.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); });
      document.body.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); });
    });

    ['dragenter', 'dragover'].forEach(ev =>
      dropZone.addEventListener(ev, () => dropZone.classList.add('dragover'))
    );

    ['dragleave', 'drop'].forEach(ev =>
      dropZone.addEventListener(ev, () => dropZone.classList.remove('dragover'))
    );

    dropZone.addEventListener('drop', e => {
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
    });

    // â”€â”€ Fetch RSA Public Key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function initPublicKey() {
      if (!crypto.subtle) {
        showStatus('WebCrypto unavailable. Open via http://localhost:3000', 'error');
        return;
      }
      try {
        const res  = await fetch('/api/public-key');
        const data = await res.json();
        const spki = pemToArrayBuffer(data.publicKey);
        rsaPublicKey = await crypto.subtle.importKey(
          'spki', spki,
          { name: 'RSA-OAEP', hash: 'SHA-256' },
          false, ['encrypt']
        );
        if (selectedFile) uploadBtn.disabled = false;
      } catch (err) {
        showStatus('Could not reach server. Is it running?', 'error');
      }
    }

    // â”€â”€ Encrypt & Upload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    uploadBtn.addEventListener('click', async () => {
      if (!selectedFile || !rsaPublicKey) return;

      uploadBtn.disabled = true;
      statusEl.style.display = 'none';

      try {
        // 1. Read file
        setProgress('Reading imageâ€¦', 5);
        const fileBuffer = await selectedFile.arrayBuffer();

        // 2. Generate AES-256-GCM session key
        setProgress('Generating session keyâ€¦', 20);
        const aesKey = await crypto.subtle.generateKey(
          { name: 'AES-GCM', length: 256 }, true, ['encrypt', 'decrypt']
        );

        // 3. Generate IV
        const iv = crypto.getRandomValues(new Uint8Array(12));

        // 4. Encrypt file with AES-GCM
        setProgress('Encrypting imageâ€¦', 40);
        const encryptedFile = await crypto.subtle.encrypt(
          { name: 'AES-GCM', iv }, aesKey, fileBuffer
        );

        // 5. Export AES key, encrypt with RSA
        setProgress('Wrapping key with RSAâ€¦', 65);
        const rawAesKey        = await crypto.subtle.exportKey('raw', aesKey);
        const encryptedAesKey  = await crypto.subtle.encrypt(
          { name: 'RSA-OAEP' }, rsaPublicKey, rawAesKey
        );

        // 6. Encode & send
        setProgress('Sending encrypted payloadâ€¦', 80);
        const payload = {
          encryptedAesKey: bufferToBase64(encryptedAesKey),
          encryptedFile:   bufferToBase64(encryptedFile),
          iv:              bufferToBase64(iv),
          filename:        selectedFile.name,
          mimeType:        selectedFile.type,
        };

        const res = await fetch('/api/upload', {
          method:  'POST',
          headers: { 'Content-Type': 'application/json' },
          body:    JSON.stringify(payload),
        });

        if (!res.ok) {
          const err = await res.json().catch(() => ({}));
          throw new Error(err.error || `HTTP ${res.status}`);
        }

        const data = await res.json();
        setProgress('Done', 100);
        showStatus(`âœ“ Delivered securely â€” ${formatBytes(data.decryptedBytes)} received by server.`, 'success');

      } catch (err) {
        showStatus(`âœ— ${err.message}`, 'error');
      } finally {
        uploadBtn.disabled = false;
      }
    });

    // â”€â”€ Gallery â€” jellyfish float â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function initGallery() {
      const TOTAL = 28; // number of floating items
      const gallery = document.getElementById('gallery');

      let images = [];
      try {
        const res = await fetch('/gallery.json');
        const data = await res.json();
        images = data.images || [];
      } catch (_) { return; }
      if (images.length === 0) return;

      // Build floaters
      const floaters = [];
      for (let i = 0; i < TOTAL; i++) {
        const src = images[i % images.length];
        const cell = document.createElement('div');
        cell.className = 'gallery-cell';
        const img = document.createElement('img');
        img.src = src;
        img.alt = '';
        img.draggable = false;
        cell.appendChild(img);
        gallery.appendChild(cell);

        const W = window.innerWidth;
        const H = window.innerHeight;
        const speed = 0.18 + Math.random() * 0.22; // px/frame, very slow
        const angle = Math.random() * Math.PI * 2;

        floaters.push({
          el: cell,
          x: Math.random() * W,
          y: Math.random() * H,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          driftAngle: Math.random() * Math.PI * 2,      // wander direction
          driftSpeed: (Math.random() - 0.5) * 0.008,   // how fast wander rotates
          bobOffset: Math.random() * Math.PI * 2,       // phase for vertical bob
          bobAmp: 0.12 + Math.random() * 0.18,          // bob strength
        });
      }

      let frame = 0;

      function tick() {
        const W = window.innerWidth;
        const H = window.innerHeight;
        frame++;

        for (const f of floaters) {
          // Slowly rotate the drift direction (Brownian wander)
          f.driftAngle += f.driftSpeed + (Math.random() - 0.5) * 0.004;
          f.vx += Math.cos(f.driftAngle) * 0.003;
          f.vy += Math.sin(f.driftAngle) * 0.003;

          // Clamp speed
          const spd = Math.sqrt(f.vx * f.vx + f.vy * f.vy);
          const maxSpd = 0.55;
          if (spd > maxSpd) { f.vx = (f.vx / spd) * maxSpd; f.vy = (f.vy / spd) * maxSpd; }

          // Gentle sinusoidal vertical bob layered on top
          const bob = Math.sin(frame * 0.012 + f.bobOffset) * f.bobAmp;
          f.vy += bob * 0.015;

          f.x += f.vx;
          f.y += f.vy;

          // Wrap around viewport edges
          const w = f.el.offsetWidth || 160;
          const h = f.el.offsetHeight || 200;
          if (f.x > W + w)  f.x = -w;
          if (f.x < -w)     f.x = W + w;
          if (f.y > H + h)  f.y = -h;
          if (f.y < -h)     f.y = H + h;

          f.el.style.transform = `translate(${f.x}px, ${f.y}px)`;
        }

        requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
    }

    // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    initPublicKey();
    initGallery();
  </script>
</body>
</html>
